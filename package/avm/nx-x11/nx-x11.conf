# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/avm/nx-X11/nx-X11.conf
# ROCK Linux is Copyright (C) 1998 - 2006 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

prefix=opt/nx
set_confopt

nx-X11_prem() {
	cd ..
	
	nxothersources="nxagent- nxauth- nxcomp- nxcompext- nxproxy-"
	for nxsource in $nxothersources; do
		nxsf=$(ls $archdir/${nxsource}*)
		echo "Extracting $nxsf ($taropt) ..."
		tar $taropt $nxsf
		if [[ $nxsource = nxcomp- ]] ; then
			patch -d nxcomp -p1 < $confdir/gcc40.diff-nxcomp
		fi
	done

	cd $OLDPWD

        echo "Configuring XFree ..."
        cat >> config/cf/host.def << EOT
/* Disable the internal zlib to use the system installed one */
#define         HasZlib                 YES
/* Disable the internal expat library to use the system installed one */
#define         HasExpat                YES
/* Less warnings with recent gccs ... */
#define         DefaultCCOptions        -ansi GccWarningOptions

EOT

}

nx-X11_postm() {
# 	 echo "Installing nxcomp"
# 	 cd ../nxcomp
# 	 eval make $makeinstopt install
# 	 cd $OLDPWD

	 echo "Installing nxcompext"
	 cd ../nxcompext
	 sed -i -e 's,^\(install.bin:.*\)$,\1\n\tln -sfv $(LIBFULL) $(prefix)/lib/$(LIBLOAD),' Makefile
	 sed -i -e 's,^\(install.bin:.*\)$,\1\n\tln -sfv $(LIBFULL) $(prefix)/lib/$(LIBSHARED),' Makefile
	 sed -i -e 's,^\(install.bin:.*\)$,\1\n\tinstall -v $(LIBFULL) $(LIBARCHIVE) $(prefix)/lib/,' Makefile
	 eval make $makeinstopt install
	 cd $OLDPWD

# 	 echo "Installing nxproxy"
# 	 cd ../nxproxy
# 	 eval make $makeinstopt install
# 	 cd $OLDPWD
}

hook_add premake 3 "nx-X11_prem"

# They don't install anything?
hook_add postmake 3 "nx-X11_postm"

var_append makeopt " " "World"
