# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/avm/xfce4/xfce4.conf
# ROCK Linux is Copyright (C) 1998 - 2006 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

if [ "$prefix_auto" = 1 ] ; then
    prefix=${ROCKCFG_PKG_XFCE4_CORE_PREFIX:-usr}
    set_confopt
fi

# It already uses a subdirectory
sysconfdir="${sysconfdir%xfce4}"

# Several packages install fr docs
[ "$ROCKCFG_DISABLE_NLS" = 1 ] && postmake="rm -rf $datadir/xfce4/doc/??{,_??}"

xfce4_custmain() {
	if [ "$prefix_auto" = 1 ]
	then
		prefix="opt/xfce4"
		set_confopt
	fi

	# we create the $prefix here - so it's not in the env yet..
	export PKG_CONFIG_PATH="$PKG_CONFIG_PATH:$libdir/pkgconfig"
	export PATH="$PATH:$bindir"

	# sometimes xfce is unsure if its own header files are
	# in /$prefix/include/ or /$prefix/include/xfce4/ ..
	var_append CC_WRAPPER_APPEND " " "-I$includedir"

	for i in \
			src/libxfce4util-*.tar.gz	\
			src/dbh-*.tar.gz		\
			src/libxfcegui4-*.tar.gz	\
			src/libxfce4mcs-*.tar.gz	\
			src/xfce-mcs-manager-*.tar.gz	\
			src/xfce4-panel-*.tar.gz	\
			src/*.tar.gz
	do 
		if [ ! -d $(basename ${i%.tar.gz}) ]; then
			echo
			echo "Building $i ..."
			tar xzf ${i}
			cd $(basename ${i%.tar.gz})

			hook_eval preconf
			echo "./configure $confopt"
			eval ./configure $confopt

			hook_eval premake
			echo "make $makeopt"
			eval make $makeopt
			echo "evaluating inmake"

			hook_eval inmake
			echo "make $makeopt $makeinstopt"
			eval make $makeopt $makeinstopt
			hook_eval postmake
			echo "Finished building $i"
			echo
			cd ..
		fi
	done
}

custmain="xfce4_custmain"

[ "$ROCKCFG_PKG_XFCE4_SANS11" = 1 ] && hook_add preconf 3 "\
	if [[ $PWD == *xfwm4-4* ]]; then \
        sed -i -e "/DEFAULT_FONT/s/10/11/" mcs-plugin/xfwm4_plugin.c; fi"
