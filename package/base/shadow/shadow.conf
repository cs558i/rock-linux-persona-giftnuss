#!/bin/bash
# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/base/shadow/shadow.conf
# ROCK Linux is Copyright (C) 1998 - 2006 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

libdir="$root/$multilib"

pc_shadow() {
    # Need to rebuild libtool files, resolve possible version conflicts
    libtoolize --copy --force
}

pm_shadow() {
	cp etc/{limits,login.access,login.defs} $sysconfdir/
	if [ -d $sysconfdir/pam.d ]; then
		for x in $(cd etc/ ; ls pam.d/[a-z]* ) ; do
			[[ "etc/$x" == *.orig ]] && continue
			if [ -f $sysconfdir/$x ]; then
				touch $sysconfdir/$x
			else
				cp etc/$x $sysconfdir/$x
			fi
		done
		sed -e 's,^\(.*loginuid\),#\1,' -i $sysconfdir/pam.d/login
	fi
	mkdir -p $localstatedir/log
	touch $localstatedir/log/{lastlog,faillog}
	[ -f $root/usr/bin/login ] && mv $root/usr/bin/login  $root/bin/
	[ -f $root/usr/bin/su    ] && mv $root/usr/bin/su     $root/bin/
	mkdir -p $sysconfdir/default
	echo 'SHELL=/bin/bash' > $sysconfdir/default/useradd
}

preconf="pc_shadow"
postmake="pm_shadow"

var_append extraconfopt " " "--enable-shared --disable-desrpc --without-selinux"
