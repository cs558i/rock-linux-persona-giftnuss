# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/public/multisync/irmc_sync-newbluetoothlibs.patch
# ROCK Linux is Copyright (C) 1998 - 2006 Clifford Wolf
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

--- ./plugins/irmc_sync/configure.orig	2004-12-18 07:37:17.148587216 +0100
+++ ./plugins/irmc_sync/configure	2004-12-18 08:12:51.570105824 +0100
@@ -4802,77 +4802,12 @@
 _ACEOF
 
   LIBS="-lbluetooth $LIBS"
+  SDP=1
 
 else
   BLUETOOTH=0
 fi
 
-echo "$as_me:$LINENO: checking for sdp_connect in -lsdp" >&5
-echo $ECHO_N "checking for sdp_connect in -lsdp... $ECHO_C" >&6
-if test "${ac_cv_lib_sdp_sdp_connect+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lsdp  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char sdp_connect ();
-int
-main ()
-{
-sdp_connect ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_sdp_sdp_connect=yes
-else
-  echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-ac_cv_lib_sdp_sdp_connect=no
-fi
-rm -f conftest.err conftest.$ac_objext \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_sdp_sdp_connect" >&5
-echo "${ECHO_T}$ac_cv_lib_sdp_sdp_connect" >&6
-if test $ac_cv_lib_sdp_sdp_connect = yes; then
-  SDP=1
-fi
 
 echo "$as_me:$LINENO: checking for correct SDP lib version" >&5
 echo $ECHO_N "checking for correct SDP lib version... $ECHO_C" >&6
@@ -4904,7 +4839,7 @@
 #define HAVE_BLUETOOTH ${BLUETOOTH}
 _ACEOF
 
-LIBS="$LIBS -lglib-2.0"
+#LIBS="$LIBS -lglib-2.0"
 
 
 echo "$as_me:$LINENO: checking for OBEX_Init in -lopenobex" >&5
--- ./plugins/irmc_sync/configure.in.orig	2004-12-18 07:38:12.279206088 +0100
+++ ./plugins/irmc_sync/configure.in	2004-12-18 08:11:04.547375752 +0100
@@ -24,7 +24,8 @@
 SDP=0
 AC_CHECK_HEADER(bluetooth/bluetooth.h, BLUETOOTH=1, BLUETOOTH=0)
 AC_CHECK_LIB(bluetooth, hci_open_dev,,BLUETOOTH=0)
-AC_CHECK_LIB(sdp, sdp_connect, SDP=1)
+AC_CHECK_HEADER(bluetooth/sdp.h, SDP=1, SDP=0)
+dnl AC_CHECK_LIB(sdp, sdp_connect, SDP=1)
 AC_MSG_CHECKING(for correct SDP lib version)
 AM_CONDITIONAL(SDP,test "${SDP}" = "1")
 AM_CONDITIONAL(BLUETOOTH,test "${BLUETOOTH}" = "1")
@@ -32,5 +33,4 @@
   echo "Bluetooth is DISABLED. You must have the bluez-libs installed."
 fi
 AC_DEFINE_UNQUOTED(HAVE_BLUETOOTH, ${BLUETOOTH},Defined if Bluetooth is enabled.)
-LIBS="$LIBS -lglib-2.0"
 
--- ./plugins/irmc_sync/src/Makefile.in.orig	2004-12-18 08:21:22.000000000 +0100
+++ ./plugins/irmc_sync/src/Makefile.in	2004-12-18 08:21:30.000000000 +0100
@@ -159,8 +159,6 @@
 	irmc_bluetooth.c irmc_bluetooth.h
 
 
-@SDP_TRUE@sdp_lib = -lsdp
-
 libirmc_bluetooth_la_LIBADD = -lbluetooth -lpthread $(sdp_lib)
 
 libirmc_sync_la_SOURCES = \
--- ./plugins/irmc_sync/src/Makefile.am.orig	2004-12-18 08:20:49.000000000 +0100
+++ ./plugins/irmc_sync/src/Makefile.am	2004-12-18 08:21:07.000000000 +0100
@@ -21,10 +21,6 @@
 libirmc_bluetooth_la_SOURCES = \
 	irmc_bluetooth.c irmc_bluetooth.h
 
-if SDP
-sdp_lib = -lsdp
-endif
-
 libirmc_bluetooth_la_LIBADD = -lbluetooth -lpthread $(sdp_lib)
 
 libirmc_sync_la_SOURCES = \
