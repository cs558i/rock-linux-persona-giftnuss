#!/bin/bash
# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/stf/openoffice/openoffice.conf
# ROCK Linux is Copyright (C) 1998 - 2006 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

chownsrcdir=0
nocvsinsrcdir=0
with_java=0
var_append extraconfopt " " "--with-package-format=portable --with-system-stdlibs"
var_append extraconfopt " " "--disable-qadevooo --disable-odk"
var_append extraconfopt " " "--disable-mozilla"

# building with java only works in manual builds for some reason.
[ "$with_java" == 0 ] && var_append extraconfopt " " " --without-java"

pkginstalled evolution	&& var_append extraconfopt " " "--enable-evolution2"
#pkginstalled firefox	&& var_append extraconfopt " " "--with-firefox"
pkginstalled openldap	&& var_append extraconfopt " " "--with-openldap"
pkginstalled bitstream-vera-fonts \
	&& var_append extraconfopt " " "--without-fonts"
pkginstalled cups	&& var_append extraconfopt " " "--without-ppds"

# if pkginstalled mozilla || pkginstalled firefox ; then
# 	var_append extraconfopt " " "--with-system-mozilla"
# fi

if pkginstalled "bdb[0-9]*" ; then
	if [ "$with_java" == 0 ] ; then
		var_append extraconfopt " " "--with-system-db"
	else
		# bdb4[12] with java bindings required; bdb 4.3 and above
		# miss a class Dbt.
		pkginstalled "bdb4[12]" && [ -e $root/usr/lib/db.jar ] && \
		var_append extraconfopt " " "--with-system-db --with-db-jar=/usr/lib/db.jar"
	fi
fi
# var_append extraconfopt " " "--with-system-dict"

pkginstalled boost	&& var_append extraconfopt " " "--with-system-boost"
pkginstalled curl	&& var_append extraconfopt " " "--with-system-curl"
pkginstalled expat	&& var_append extraconfopt " " "--with-system-expat"
pkginstalled freetype	&& var_append extraconfopt " " "--with-system-freetype"
pkginstalled libjpeg	&& var_append extraconfopt " " "--with-system-jpeg"
pkginstalled libicu	&& var_append extraconfopt " " "--with-system-icu"
pkginstalled libmspack	&& var_append extraconfopt " " "--with-system-mspack"
pkginstalled libxml2	&& var_append extraconfopt " " "--with-system-libxml"
pkginstalled nas	&& var_append extraconfopt " " "--with-system-nas"
#pkginstalled neon	&& var_append extraconfopt " " "--with-system-neon"
pkginstalled portaudio	&& var_append extraconfopt " " "--with-system-portaudio"
pkginstalled python	&& var_append extraconfopt " " "--with-system-python"
pkginstalled sndfile	&& var_append extraconfopt " " "--with-system-sndfile"
pkginstalled startup-notification \
			&& var_append extraconfopt " " "--with-system-libsn"
pkginstalled zlib	&& var_append extraconfopt " " "--with-system-zlib"

pkginstalled sane	&& var_append extraconfopt " " "--with-system-sane-headers"
pkginstalled libxrender	&& var_append extraconfopt " " "--with-system-xrender-headers"

openoffice_custmain() {
	# extract
	for x in system ; do
		tar $taropt $archdir/OOo_${ver}_src_${x}.tar.bz2 -C ../
	done

	unzip $archdir/gpc${GPCVER//./}.zip
	mv gpc*/* external/gpc

	cp -a $archdir/unowinreg.dll external/unowinreg
#	cp -a $archdir/mozilla-source-$MOZVER.tar.bz2 moz/download

	cd config_office
	eval $configprefix ./configure $confopt
	echo $configprefix ./configure $confopt

	# build
	cd ..
	. Linux*Env.Set.sh
	./bootstrap
	dmake

	# install
	cd instsetoo_native/unxlngi6.pro/OpenOffice/portable/install
	for x in ./*/*/openoffice.org-*.sw ; do
		[ -f "$x" ] && tar xf "$x" -C ${root:-/}
	done
}

custmain=openoffice_custmain

# cpan-archive-zip
# sun-jdk15
# orbit2 gconf gnome-mime-data gnome-vfs
# ant
