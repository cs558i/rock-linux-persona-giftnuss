# 
# [COPY] --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# [COPY] 
# [COPY] This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# [COPY] Please add additional copyright information _after_ the line containing
# [COPY] the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# [COPY] the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# [COPY] 
# [COPY] ROCK Linux: rock-src/package/teha/rescue-stage1-init/rescue-stage1-init.desc
# [COPY] ROCK Linux is Copyright (C) 1998 - 2007 Clifford Wolf
# [COPY] 
# [COPY] This program is free software; you can redistribute it and/or modify
# [COPY] it under the terms of the GNU General Public License as published by
# [COPY] the Free Software Foundation; either version 2 of the License, or
# [COPY] (at your option) any later version. A copy of the GNU General Public
# [COPY] License can be found at Documentation/COPYING.
# [COPY] 
# [COPY] Many people helped and are helping developing ROCK Linux. Please
# [COPY] have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# [COPY] file for details.
# [COPY] 
# [COPY] --- ROCK-COPYRIGHT-NOTE-END ---

build_main() {
	INST_DIR=$root/lib/rock_initramfs

	mkdir -p $INST_DIR/libexec/

	$CC ${confdir}/libexec/gen_init_cpio.c -o $INST_DIR/libexec/gen_init_cpio

	install -m 755 ${confdir}/libexec/functions ${INST_DIR}/libexec/
	install -m 755 ${confdir}/libexec/build-list.sh ${INST_DIR}/libexec/

	install -m 755 ${confdir}/libexec/mkinitramfs.sh ${root}/usr/sbin/mkinitramfs

	# copy $confdir/build.d/* into running system...
	mkdir -p ${INST_DIR}/build.d
	for x in ${confdir}/build.d/*
	do
		install -m 644 ${x} ${INST_DIR}/build.d/
	done
	
	(
		# copy $confdir/files into the running system...
		cd ${confdir}/files
		find . -name .svn -prune -o -type d -exec mkdir -p ${INST_DIR}/files/{} ';'
		find . -name .svn -prune -o -type f -exec cp -v {} ${INST_DIR}/files/{} ';'
	)
}

autoextract=0
srctar="none"
custmain="build_main"
