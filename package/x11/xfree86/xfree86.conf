# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/package/x11/xfree86/xfree86.conf
# ROCK Linux is Copyright (C) 1998 - 2006 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

# include the configuration script for XFree ...
. package/x11/xfree86/xf_config.sh

x11base_main() {
	xf_dirtree
	xf_extract

	xf_extract_gl
	xf_extract_hallib
	xf_extract_gatos
	xf_patch

	xf_config

	xf_build
	xf_install
	xf_build_install_gatos
}

x11base_stage0() {
	touch config/cf/host.def
	touch config/cf/version.def
	touch config/cf/date.def

	cd config/imake
	mv imakemdep.h imakemdep.h.bak
	cat <<EOT > imakemdep.h
#define ARGUMENTS 50
char *cpp_argv[50] = {
 "cc",
 "-I.",
 "-Uunix",
 "-D__${arch_machine}__",
 "-m$(( arch_sizeof_long * 8 ))",
 "-traditional",
 "-D${arch_machine}",
 "-Dlinux",
};
EOT
	make -f Makefile.ini
	cp -v imake $root/bin/

	mv imakemdep.h.bak imakemdep.h
	make -f Makefile.ini clean
	make -f Makefile.ini

	cd ../util
	../imake/imake -I../cf -DTOPDIR=../.. -DCURDIR=config/util
	make

	cd ../makedepend
	../imake/imake -I../cf -DTOPDIR=../.. -DCURDIR=config/makedepend
	make

	cd ../..
	cp -v config/util/rman $root/bin/
	cp -v config/makedepend/makedepend $root/bin/
}

if [ $stagelevel -gt 0 ]; then
	custmain=x11base_main
	autoextract=0
	createdocs=0
else
	custmain=x11base_stage0
fi

# don't put the modules in a :dev package
splitreg 45 . '/lib/modules/'

# this is fixes many cyclic dependencies..
var_append flistrfilter "|" ".*mkhtmlindex.pl.*X11/doc/html.*"

# auto-create missing *.a files
autoso2a=1

forcefpic=0

