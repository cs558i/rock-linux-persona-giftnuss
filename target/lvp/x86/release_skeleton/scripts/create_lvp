#!/bin/bash
# --- ROCK-COPYRIGHT-NOTE-BEGIN ---
# 
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# Please add additional copyright information _after_ the line containing
# the ROCK-COPYRIGHT-NOTE-END tag. Otherwise it might get removed by
# the ./scripts/Create-CopyPatch script. Do not edit this copyright text!
# 
# ROCK Linux: rock-src/target/lvp/x86/release_skeleton/scripts/create_lvp
# ROCK Linux is Copyright (C) 1998 - 2006 Clifford Wolf
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version. A copy of the GNU General Public
# License can be found at Documentation/COPYING.
# 
# Many people helped and are helping developing ROCK Linux. Please
# have a look at http://www.rocklinux.org/ and the Documentation/TEAM
# file for details.
# 
# --- ROCK-COPYRIGHT-NOTE-END ---

. scripts/functions

if [ ! -e .config ] ; then
	echo "${bold}${red}No configuration found!${normal}"
	echo "Run ./config.sh first!"
	exit 1
fi

. .config

for x in create_lvpxml encrypted plain ; do
	. scripts/${x}
done

moviefiles="/tmp/lvp_moviefiles.${$}"

trap "rm -f ${moviefiles}" EXIT
trap "exit 1" INT

case "${LVP_SIZE}" in
	cd)
		size=700
		;;
	dvd)
		size=4486
		;;
	other)
		size=${LVP_SIZE_OTHER}
		;;
esac

if ! eval "type=\${type_${LVP_TYPE}}" ; then
	echo "${bold}${red}Unknown type ${LVP_TYPE}${normal}"
	exit 1
fi

mplayer_param=${LVP_MPLAYER_OPTS}

eval "for x in ${LVP_FILES} ; do echo \${x} ; done" >${moviefiles}

echo "Verifying existence of files ... "
error=0
while read file ; do
	if [ ! -f "${file}" ] ; then
		echo "${file}: no such file or directory"
		error=$(( ${error} + 1 ))
	fi
done < ${moviefiles}

if [ ${error} -gt 0 ] ; then
	echo "Couldn't find ${error} file(s)."
	confirm "Continue without those files"
	[ ${?} -eq 1 ] && exit 1
fi

eval "process_${LVP_TYPE}"
